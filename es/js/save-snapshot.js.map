{"version":3,"sources":["../../src/js/save-snapshot.js"],"names":["snapshotTrigger","getLog","saveSnapshot","pool","snapshotKey","content","log","databaseName","snapshotsTableName","escape","escapeId","executeStatement","databaseNameAsId","snapshotsTableNameAsId","debug"],"mappings":"AAAA,SAASA,eAAT,QAAgC,yBAAhC;AACA,OAAOC,MAAP,MAAmB,WAAnB;;AAEA,MAAMC,YAAY,GAAG,OAAOC,IAAP,EAAaC,WAAb,EAA0BC,OAA1B,KACnBL,eAAe,CAACG,IAAD,EAAOC,WAAP,EAAoBC,OAApB,EAA6B,YAAY;AACtD,QAAMC,GAAG,GAAGL,MAAM,CAAE,gBAAeG,WAAY,EAA7B,CAAlB;AAEA,QAAM;AACJG,IAAAA,YADI;AAEJC,IAAAA,kBAFI;AAGJC,IAAAA,MAHI;AAIJC,IAAAA,QAJI;AAKJC,IAAAA;AALI,MAMFR,IANJ;AAQA,QAAMS,gBAAgB,GAAGF,QAAQ,CAACH,YAAD,CAAjC;AACA,QAAMM,sBAAsB,GAAGH,QAAQ,CAACF,kBAAD,CAAvC;AAEAF,EAAAA,GAAG,CAACQ,KAAJ,CAAW,kCAAX;AACA,QAAMH,gBAAgB,CACnB,eAAcC,gBAAiB,IAAGC,sBAAuB;;;;aAInDJ,MAAM,CAACL,WAAD,CAAc,KAAIK,MAAM,CAACJ,OAAD,CAAU;;8BAEvBI,MAAM,CAACJ,OAAD,CAAU,EAPpB,CAAtB;AASAC,EAAAA,GAAG,CAACQ,KAAJ,CAAW,iCAAX;AACD,CAzBc,CADjB;;AA4BA,eAAeZ,YAAf","sourcesContent":["import { snapshotTrigger } from 'resolve-eventstore-base'\nimport getLog from './get-log'\n\nconst saveSnapshot = async (pool, snapshotKey, content) =>\n  snapshotTrigger(pool, snapshotKey, content, async () => {\n    const log = getLog(`saveSnapshot:${snapshotKey}`)\n\n    const {\n      databaseName,\n      snapshotsTableName,\n      escape,\n      escapeId,\n      executeStatement,\n    } = pool\n\n    const databaseNameAsId = escapeId(databaseName)\n    const snapshotsTableNameAsId = escapeId(snapshotsTableName)\n\n    log.debug(`writing the snapshot to database`)\n    await executeStatement(\n      `INSERT INTO ${databaseNameAsId}.${snapshotsTableNameAsId}(\n      \"snapshotKey\", \n      \"snapshotContent\"\n    )\n    VALUES(${escape(snapshotKey)}, ${escape(content)})\n    ON CONFLICT (\"snapshotKey\") DO UPDATE\n    SET \"snapshotContent\" = ${escape(content)}`\n    )\n    log.debug(`the snapshot saved successfully`)\n  })\n\nexport default saveSnapshot\n"],"file":"save-snapshot.js"}
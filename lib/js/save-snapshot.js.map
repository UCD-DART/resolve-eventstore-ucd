{"version":3,"sources":["../../src/js/save-snapshot.js"],"names":["saveSnapshot","pool","snapshotKey","content","log","databaseName","snapshotsTableName","escape","escapeId","executeStatement","databaseNameAsId","snapshotsTableNameAsId","debug"],"mappings":";;;;;;;AAAA;;AACA;;;;AAEA,MAAMA,YAAY,GAAG,OAAOC,IAAP,EAAaC,WAAb,EAA0BC,OAA1B,KACnB,4CAAgBF,IAAhB,EAAsBC,WAAtB,EAAmCC,OAAnC,EAA4C,YAAY;AACtD,QAAMC,GAAG,GAAG,qBAAQ,gBAAeF,WAAY,EAAnC,CAAZ;AAEA,QAAM;AACJG,IAAAA,YADI;AAEJC,IAAAA,kBAFI;AAGJC,IAAAA,MAHI;AAIJC,IAAAA,QAJI;AAKJC,IAAAA;AALI,MAMFR,IANJ;AAQA,QAAMS,gBAAgB,GAAGF,QAAQ,CAACH,YAAD,CAAjC;AACA,QAAMM,sBAAsB,GAAGH,QAAQ,CAACF,kBAAD,CAAvC;AAEAF,EAAAA,GAAG,CAACQ,KAAJ,CAAW,kCAAX;AACA,QAAMH,gBAAgB,CACnB,eAAcC,gBAAiB,IAAGC,sBAAuB;;;;aAInDJ,MAAM,CAACL,WAAD,CAAc,KAAIK,MAAM,CAACJ,OAAD,CAAU;;8BAEvBI,MAAM,CAACJ,OAAD,CAAU,EAPpB,CAAtB;AASAC,EAAAA,GAAG,CAACQ,KAAJ,CAAW,iCAAX;AACD,CAzBD,CADF;;eA4BeZ,Y","sourcesContent":["import { snapshotTrigger } from 'resolve-eventstore-base'\nimport getLog from './get-log'\n\nconst saveSnapshot = async (pool, snapshotKey, content) =>\n  snapshotTrigger(pool, snapshotKey, content, async () => {\n    const log = getLog(`saveSnapshot:${snapshotKey}`)\n\n    const {\n      databaseName,\n      snapshotsTableName,\n      escape,\n      escapeId,\n      executeStatement,\n    } = pool\n\n    const databaseNameAsId = escapeId(databaseName)\n    const snapshotsTableNameAsId = escapeId(snapshotsTableName)\n\n    log.debug(`writing the snapshot to database`)\n    await executeStatement(\n      `INSERT INTO ${databaseNameAsId}.${snapshotsTableNameAsId}(\n      \"snapshotKey\", \n      \"snapshotContent\"\n    )\n    VALUES(${escape(snapshotKey)}, ${escape(content)})\n    ON CONFLICT (\"snapshotKey\") DO UPDATE\n    SET \"snapshotContent\" = ${escape(content)}`\n    )\n    log.debug(`the snapshot saved successfully`)\n  })\n\nexport default saveSnapshot\n"],"file":"save-snapshot.js"}